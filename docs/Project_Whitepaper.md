# 智能桌宠 (Smart Desktop Pet) - 项目技术白皮书 (Final Release)

## 1. 项目概述

**智能桌宠 (Smart Desktop Pet)** 是一款基于生成式 AI (AIGC) 驱动的沉浸式桌面伴侣系统。本项目突破了传统桌面精灵“预设脚本、机械反馈”的限制，通过深度集成大语言模型 (LLM) 与端侧语音合成 (TTS) 技术，赋予了虚拟角色（如《原神》胡桃）以“灵魂”。

该系统不仅具备高精度的视觉呈现与流畅的 Live2D/序列帧动画，更拥有基于 RAG (检索增强生成) 的长期记忆能力与个性化情感引擎，能够实现自然、有温度的多模态人机交互。

## 2. 核心功能特性

### 2.1 全双工多模态交互
*   **智能对话**: 内置微调后的 LLM 引擎，支持开放域闲聊、角色扮演 (Role-Play) 及情感抚慰，具备上下文理解与长期记忆能力。
*   **实时语音 (TTS)**: 搭载 VITS-Fast-Fine-Tuning 模型，实现了 <200ms 延迟的流式语音合成。角色音色高度还原（如胡桃特有的俏皮语调），并支持情感参数控制（开心、生气、撒娇）。
*   **视觉反馈**: 语音与嘴型 (Lip-Sync) 实时同步，动作与对话情感自动匹配。

### 2.2 高度可定制化引擎
*   **角色工坊 (Character Workshop)**: 提供可视化的配置工具，用户可一键导入 PNG 序列帧或 Live2D 模型。
*   **声音克隆 (Voice Cloning)**: 内置少样本 (Few-Shot) 学习模块，用户仅需上传 10 句音频，即可在本地训练出专属的角色音色。
*   **自定义性格**: 通过 Prompt Engineering (提示词工程) 接口，用户可自定义角色的性格设定（如“傲娇”、“温柔”）。

### 2.3 沉浸式桌面体验
*   **无感驻留**: 采用 Layered Window 技术实现像素级透明渲染，CPU 占用 <2%，内存占用 <100MB (纯净模式)。
*   **环境感知**: 角色能感知当前时间、系统状态（如电量低时提醒），并做出相应的行为反馈。

## 3. 技术架构设计

项目采用 **"端侧推理 + 异步渲染"** 的双进程架构，确保在高负载 AI 计算下 UI 依然丝般顺滑。

| 层级 | 关键技术 | 实现细节 |
| :--- | :--- | :--- |
| **表现层 (UI)** | **PyQt5 / PySide6** | 负责透明窗体渲染、事件捕获与动画插值。采用 QGraphicsView 框架实现高性能 2D 渲染。 |
| **逻辑层 (Brain)** | **Behavior Tree (行为树)** | 管理角色的决策逻辑（如：Idle -> 观察 -> 对话）。基于 Python `asyncio` 实现异步任务调度。 |
| **模型层 (AI)** | **OnnxRuntime / PyTorch** | **LLM**: 采用量化版 (Int4) ChatGLM3/Qwen，适配 6G 显存环境。<br>**TTS**: VITS 模型深度优化，支持流式输出 (Streaming Output)。 |
| **数据层 (Data)** | **SQLite + VectorDB** | **SQLite**: 存储配置与对话日志。<br>**FAISS**: 向量数据库，用于存储用户偏好与长期记忆 (RAG)。 |

## 4. 核心技术难点与突破

### 4.1 跨进程共享内存通信
为了解决 Python GIL 锁导致的界面卡顿问题，我们将 AI 推理（LLM/TTS）剥离至独立进程，通过 **Shared Memory (共享内存)** 与 UI 进程通信。这使得即使后台在生成复杂的语音流，前台角色的动作依然保持 60FPS 的流畅度。

### 4.2 语音口型同步 (Lip-Sync)
传统方案依靠简单的音量控制嘴型开合。本项目引入了 **Viseme (视素)** 映射算法，分析 TTS 生成的音素 (Phoneme) 序列，精准控制角色的口型变化（如 a, o, e, m, p），实现了接近动画级的一致性。

### 4.3 动态资源热重载
实现了一套热插拔的资源管理系统。用户替换角色图片或语音包后，系统无需重启，通过文件系统监听 (File Watcher) 自动无缝切换资源，极大提升了用户 DIY 的便捷性。

## 5. 总结
本项目成功展示了如何将庞大的 AI 模型“轻量化”并落地到个人消费级设备上。它不仅是一个有趣的桌面玩具，更是一套完整的**端侧智能伴侣解决方案**，为未来的人机交互形态提供了极具价值的参考范本。